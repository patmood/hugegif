<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Huge Gif</title>
</head>
<body>
  <div id="container"></div>

  <script type="text/template" id="tpl-index">
    <h1>Hello Word</h1>
  </script>

  <script type="text/template" id="tpl-links-list">
    <h1>Subreddit</h2>
    Links found: <%= links.length %>
    <ul>
      <% _.each(links, function(link){ %>
        <li><%= link.get('data').title %></li>
      <% }); %>
    </ul>
  </script>
  <script src="js/lib/jquery-1.10.2.min.js"></script>
  <script src="js/lib/underscore-min.js"></script>
  <script src="js/lib/backbone-min.js"></script>
  <script>

    // MODELS
    var Link = Backbone.Model.extend({
        initialize:function(obj) {
            // console.log("Created: ",obj.data.title);
        }
    });

    var LinksList = Backbone.Collection.extend({
        initialize: function(subreddit){
          this.subreddit = subreddit
        },
        model: Link,
        // subreddit: 'gif',
        sync: function(method, model, options) {
            var params = _.extend({
                type: 'GET',
                dataType: 'jsonp',
                url: model.url(),
                processData: false
            }, options);

            return $.ajax(params);
        },
        parse: function(response) {
            return response.data.children;
        },

        url: function() {
            return "http://www.reddit.com/r/" + this.subreddit + "/.json?limit=10&after=&jsonp=?";
        }
    });

    // VIEWS
    var LinksListView = Backbone.View.extend({
      el: '#container',
      initialize: function(subreddit) {
        if(typeof subreddit === 'undefined' || subreddit === '') return;
        this.render(subreddit);
      },
      render: function(subreddit) {
        var _this = this
        var linksList = new LinksList(subreddit);
        linksList.fetch({
          success: function(linksList){
            var template = _.template( $('#tpl-links-list').html(), {links: linksList.models} );
            _this.$el.html(template);
          }
        });
      }
    });

    var IndexView = Backbone.View.extend({
      el: '#container',
      initialize: function(){
        this.render();
      },
      render: function(){
        var template = _.template( $('#tpl-index').html() );
        this.$el.html(template);
      }
    });

    var linksListView = new LinksListView();
    var indexView = new IndexView();

    // ROUTER
    var AppRouter = Backbone.Router.extend({
      routes:{
        "":"index",
        "r/:sub":"subreddit"
      },
      index: function(){
        indexView.render();
      },
      subreddit: function(sub){
        linksListView.render(sub);
      }
    });

    // GO BABY GO!
    var app = new AppRouter();

    Backbone.history.start();

  </script>
</body>
</html>
